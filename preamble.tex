%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 모든 패키지, 사용자 정의 매크로 호출 
% 호출 경로는 컴파일이 일어나는 main 기준으로 두 단계 올라가서 다시 내려옴
% 기본 골격
\input{../../structure/package.sty}
\input{../../structure/format.sty}
\input{../../structure/page.sty}
% 응용함수
\input{../../structure/seolmode.sty}
\input{../../structure/box.sty}
\input{../../structure/tablefigure.sty}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 페이지 설정
\newcommand{\geoTop}   {20mm} % 위쪽 여백
\newcommand{\geoBottom}{20mm} % 아래 여백
\newcommand{\geoLeft}  {20mm} % 좌측 여백
\newcommand{\geoRight} {20mm} % 우측 여백
\geometry{a4paper, % 기본용지 설정. 위의 숫자만 바꾸면 됨.
top=\geoTop, bottom=\geoBottom, left=\geoLeft, right=\geoRight}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 경고 무시
\hbadness=10000 % underfull hbox 경고 무시(수평 방향 여백 경고 badness 10000까지 무시)
\vbadness=10000 % overfull hbox 경고 무시(수직 방향 페이니 나눔 단락 경고 badness 10000까지 무시)
\hfuzz=7pt  % 7pt 이하의 overfull \hbox 경고 무시


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% main.tex 명령어 단순화
% 제목, 서문, 목차 불러오는 함수 만들기
\newcommand{\includeHead}[1]{\input{../includes/#1.tex}} % 경로 확인할 것

% 참고문헌 불러오기
\newcommand{\setupBib}{ % 참고문헌 있는 경우 불러오기
  \usepackage[backend=biber, style=numeric, sorting=none]{biblatex}
  \usepackage{csquotes}
  \addbibresource{../bib/papers.bib}
  \addbibresource{../bib/references.bib}
  \addbibresource{../bib/websites.bib}}
\newcommand{\printBib}{ % sloppy로 참고문헌 출력시 길이가 길다면 강제 줄바꿈
  \begin{sloppypar} \printbibliography \end{sloppypar}}

% 챕터 불러오기 - 이거 안쓰기로 함. 저장으로 컴파일이 안되는 문제 발생함
\newcommand{\loadchapter}[1]{\subimport{../chapters/#1/}{chapter.tex}}
% 히든 챕터 불러오기 - 본문에 안쓰는 챕터지만 식 참조 위하여 외부참조하기 위함 (aux 파일 한 번 컴파일 해야 함)
\newcommand{\hiddenchapter}[1]{%
  \externaldocument[]{../chapters/#1/chapter}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 캡션, 링크
\renewcommand{\equationautorefname}{Eq.} % 수식 참조 시 equation이 아닌 Eq. 로 나옴. aliascnt 필요
\renewcommand{\figureautorefname}{Fig.} % figure는 Fig
\renewcommand{\tableautorefname}{Table.} % table은 Table 그대로
\captionsetup[figure]{name=Fig.} % 그림 아래 캡션도 Fig. 으로 나오도록 함. caption 필요

\DeclareCaptionFont{mycaptionfont}{\fontsize{8pt}{9pt}\selectfont} % 폰트 크기와 위아래 여백
\captionsetup[figure]{font=mycaptionfont}
\captionsetup[table]{font=mycaptionfont}
\captionsetup[figure]{width=0.8\linewidth} % 캡션 너비 조절 - 본문 너비의 80%로 고정
\captionsetup[table]{width=0.8\linewidth}

\numberwithin{equation}{section} % eq, figure, table이 표시되는 것을 section까지 설정함. 설정하지 않으면 18.1처럼 chapter 별로 정리됨
\numberwithin{figure}{section}
\numberwithin{table}{section}

\AtBeginDocument{ % 다른 설정으로 바뀌지 않도록 고정해버림
% 캡션
\setlength{\abovecaptionskip}{3pt}  % 캡션 위 간격 - 캡션이 위에 있으면 캡션과 그림 사이 간격
\setlength{\belowcaptionskip}{0pt}  % 캡션 아래 간격

% 수식
\setlength{\abovedisplayskip}{5pt}      % 일반적인 디스플레이 수식 위쪽 간격, 모두 0이면 본문과 똑같이 모두 붙음
\setlength{\belowdisplayskip}{5pt}      % 일반적인 디스플레이 수식 아래쪽 간격
\setlength{\abovedisplayshortskip}{5pt} % 특수상황(수식 앞줄이 짧게 끝나는 경우)
\setlength{\belowdisplayshortskip}{5pt} % 특수상황(수식 아랫줄이 짧게 끝나는 경우)

% 본문 포함(인라인)
\setlength{\lineskiplimit}{3pt}         % 인라인 모드 한계치(줄높이가 baselineskip보다 얼마나 부족한가)
\setlength{\lineskip}{3pt}              % 한계치보다 부족한 경우 추가 여유 간격
} % 0pt로 하면 모두 붙어버림, 아래 두줄의 인라인은 본문에도 해당됨

% 문제 풀이시 1값을 주면 문제가 출력되고, 0값을 주면 문제가 출력되지 않음
\newcommand{\qblock}[2]{\ifnum #1 = 1\relax #2 \fi}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 페이지 벗어나는 상자(그림, 메모) 안쪽으로 밀어넣기(shift)
% 좌표/크기 저장
\newsavebox{\edgebox}
\newlength\halfbox % 가운데 점을 기준으로 위아래로 커지기 때문에 박스의 절반 길이를 구해야 함
\newlength\Ytop \newlength\Ybottom \newlength\Ycenter
\newlength\Yboxtop \newlength\Yboxbottom
\newlength\yshiftEdge % 각종 길이 선언함

% 오프셋(종이 경계 기준 데드라인) - 데드라인을 만들기 위해 오프셋을 줄 수 있음
\newlength\TopOffset     \setlength{\TopOffset}{40pt} % 위에서 내려올 거리
\newlength\BottomOffset  \setlength{\BottomOffset}{40pt} % 아래에서 올라올 거리

% 정해진 컨텐츠(메모, 그림상자)의 절반 높이를 측정하여 halfbox에 설정
\newcommand{\MeasureHalfFrom}[1]{%
  \sbox{\edgebox}{#1}%
  \setlength{\halfbox}{.5\dimexpr \ht\edgebox+\dp\edgebox\relax}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%% 박스 내부에서 메모 shift 위해서 로컬 이동량 잡아서 보정하려는데 하는데 잘 안잡힘

% 로컬 진행량(박스 내부에서만 누적; 기본 0)
\newlength\Ylocal
\setlength{\Ylocal}{0pt}

% 박스(예: minipage, tabular) 시작 시 호출
\newcommand{\YlocalReset}{\setlength{\Ylocal}{0pt}}

% 길이 직접 더하기(줄 하나 내렸으면 \baselineskip 등)
\newcommand{\YlocalAdd}[1]{\addtolength{\Ylocal}{#1}}

% 실제 콘텐츠 높이를 '측정해서' 누적 (폭을 지정할 수 있음; 기본 \linewidth)
\newcommand{\YlocalFrom}[2][\linewidth]{%
  \sbox{\edgebox}{\begin{minipage}{#1}#2\end{minipage}}%
  \addtolength{\Ylocal}{\dimexpr \ht\edgebox+\dp\edgebox\relax}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% 현재 위치 좌표 계산(페이지 좌표계: 위=\paperheight, 아래=0)
\newcommand{\CoordsHere}{%
  \setlength{\Ytop}{\dimexpr \paperheight-\TopOffset\relax}%
  \setlength{\Ybottom}{\BottomOffset}%
  \setlength{\Ycenter}{\dimexpr \paperheight-\pagetotal-\Ylocal\relax} % 메모, 그림 박스가 삽입되는 중심점, \pagetotal에서 '로컬 누적 보정'을 빼서 현재 y를 잡음
  \setlength{\Yboxtop}{\dimexpr \Ycenter+\halfbox\relax} % 박스 상단
  \setlength{\Yboxbottom}{\dimexpr \Ycenter-\halfbox\relax}} % 박스 하단

% 데드라인으로부터 넘어가는 값을 이동(shift)하여 보정
\newcommand{\ClampFromCoords}{%
  \setlength{\yshiftEdge}{0pt}%
  \ifdim \Yboxbottom<\Ybottom % 아래에 지정된 데드라인보다 박스가 내려가면
    \setlength{\yshiftEdge}{\dimexpr \Ybottom-\Yboxbottom\relax} %  넘어가는 값(+)을 shift 값으로 가짐 - 위로 올림
  \else\ifdim \Yboxtop>\Ytop % 위에 지정된 데드라인보다 박스가 올라가면
    \setlength{\yshiftEdge}{\dimexpr \Ytop-\Yboxtop\relax}\fi\fi} % 넘어가는 값(-)을 shift 값으로 가짐 - 아래로 내림

% 좌표 디버깅용 - \PrintCoords로 위, 아래, 중심, 박스위아래 출력할 수 있음
\newcommand{\PrintCoords}{%
  Top=\the\Ytop,\quad Bottom=\the\Ybottom,\quad
  Center=\the\Ycenter,\quad BoxTop=\the\Yboxtop,\quad BoxBottom=\the\Yboxbottom\par}