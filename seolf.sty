%% \seolfa{단어} 형태로 사용
%% 출력 모드는 \seolmode 값으로 제어
% 1=그대로 출력
% 2=( 글자 숨김 ), 학생용 빈칸
% 3=( 붉게 강조 ), 답안배포용
% 4=( 붉게 강조 ) 및 메모 노출, 교사용

\newcount\seolmode

\newcommand{\seolfa}[1]{% a는 괄호가 있음. mbox로 하나의 덩어리로 묶어서 줄바꿈 되지 않게 함.
  \ifnum\seolmode=1
    \mbox{\hly{\bd{#1}}}%
  \else\ifnum\seolmode=2
    \mbox{(\quad \hlw{\bd{\phantom{#1}}} \quad)}%
  \else\ifnum\seolmode=3
    \mbox{\textcolor{red}{(\quad \hly{\bd{#1}} \quad)}}%
  \else\ifnum\seolmode=4
    \mbox{\textcolor{red}{(\quad \hly{\bd{#1}} \quad)}}%
  \fi\fi\fi\fi
}

\newcommand{\seolfb}[1]{% b는 괄호가 없음. 표 안의 내용 등에 활용. 줄바꿈 가능
  \ifnum\seolmode=1
    \hly{\bd{#1}}%
  \else\ifnum\seolmode=2
    \hlw{\textcolor{white}{\bd{#1}}}%
  \else\ifnum\seolmode=3
    \hly{\textcolor{red}{\bd{#1}}}%
  \else\ifnum\seolmode=4
    \hly{\textcolor{red}{\bd{#1}}}%
  \fi\fi\fi\fi
}

%% 교사용 녹색 하이라이트 (seolmode가 4일 때는 \hll(라임형광펜), 나머지는 \hlw(화이트) - 똑같이 여백 차지하게 하려고 hlw 씀
\newcommand{\seoli}[1]{%
  \ifnum\seolmode=4 \hll{#1}%
  \else \hlw{#1}\fi}

%% memo 마커 (seolmode가 4일 때만 출력하고 1,2,3일때는 사라짐 - 처음부터 공간 차지 안함)
\newcommand{\memo}[1]{%
  \ifnum\seolmode=4 \zz % 항상 zz로 한 줄 없애고 시작하기. 언제나 독립적으로 위아래가 비워진 상태로 memo 삽입해야 함
    \tikz[overlay]{% 현재 줄 기준 그림을 겹쳐서 출력 (본문 레이아웃에 영향 없음)
      \ifodd\value{page} % 페이지 번호가 홀수이면
        \node[anchor=base west, xshift=+382pt, text width=140pt, align=left] at (0,0) {%
          \scriptsize\fboxsep=0pt % 작은 글자로 크기 설정, 박스 여백 0으로 설정
          \colorbox{yellow!20}{\parbox{140pt}{#1}}}; % 노란색 배경 박스에 입력된 내용 출력
      \else % 페이지 번호가 짝수이면
        \node[anchor=base west, xshift=-159pt, text width=140pt, align=left] at (0,0) {%
          \scriptsize\fboxsep=0pt
          \colorbox{yellow!20}{\parbox{140pt}{#1}}};\fi}\fi\ignorespaces}%

% 솔루션 하이라이트, solight - 모드가 3 이상일때만 orange 출력
\newcommand{\soli}[1]{%
  \ifnum\seolmode>2
    \highLight[{[RGB]{255,220,70}}]{#1}%
  \else
    #1%
  \fi}

% 답안용 파란 테두리 솔루션박스% 답안용 파란 테두리 솔루션박스 (seolmode가 3,4일때만 출력하고 1,2일때는 사라짐)
% \ifnum\seolmode>2 % seolmode가 3이상이면 출력
\NewTColorBox{solsolbox}{O{} g}{ % 제목을 {}안에 넣으면 제목이 함께 출력됨
  title={\raisebox{0pt}[9pt][2pt]{Solution\IfNoValueF{#2}{. \,\, #2}}},
  colback=white,        % 흰색 배경
  colframe=blue!50,     % 중간 파란 테두리
  coltitle=black,       % 제목 글씨색
  colbacktitle=white,   % 제목 배경색
  boxrule=1pt,          % 굵은 테두리 선
  arc=2mm,              % 살짝 둥근 모서리
  left=4pt, right=4pt,  % 좌우 여백
  top=4pt, bottom=4pt,   % 상하 여백
  before upper={ % 박스 안에서도 위아래 여백이 본문과 동일하게 세팅되어야 함.
  \setlength{\lineskiplimit}{2pt} % 인라인 위아래 간격이 임계값보다 작으면
  \setlength{\lineskip}{5pt} % 추가 간격 확보(수식 입력 등에 유용함)
  \setlength{\abovedisplayskip}{5pt} % 일반적인 디스플레이 수식 여백 설정
  \setlength{\belowdisplayskip}{5pt}
  \setlength{\abovedisplayshortskip}{5pt} % 특수상황(수식 앞줄이 짧게 끝나는 경우)
  \setlength{\belowdisplayshortskip}{5pt}}} % 특수상황(수식 아랫줄이 짧게 끝나는 경우)
% 모드 변경용 하얀박스
\NewTColorBox{whitesolsolbox}{O{} g}{ % 위의 solsolbox와 완전 똑같이 만들고 전부 흰색으로 처리함
  title={\raisebox{0pt}[9pt][2pt]{\textcolor{white}{Solution\IfNoValueF{#2}{. \,\, #2}}}}, 
  colback=white, colframe=white, coltitle=white, colbacktitle=white,boxrule=1pt, arc=2mm, left=4pt, right=4pt, top=4pt, bottom=4pt,before upper={\setlength{\lineskiplimit}{2pt}\setlength{\lineskip}{5pt}\setlength{\abovedisplayskip}{5pt}\setlength{\belowdisplayskip}{5pt}\setlength{\abovedisplayshortskip}{5pt}\setlength{\belowdisplayshortskip}{5pt}}}


% 환경정의
\NewDocumentEnvironment{solbox}{O{} g}{%
  \ifnum\seolmode>2
    \begin{solsolbox}[#1]{#2}%
  \else\begin{whitesolsolbox}[#1]{#2}\color{white}\fi}{%
  \ifnum\seolmode>2
    \end{solsolbox}%
  \else\end{whitesolsolbox}\fi}


% 교사용 페이지 삽입 명령 - 3 이상일 때 노출됨
\newcommand{\insertTeacherPages}[2]{%
  \ifnum\seolmode>2
    \clearpage
    \thispagestyle{empty}
    {\centering\red{\Large\bd{[ 교사용 페이지(양면) 1/2 ]}} \par}
    \vspace{1em}
    \normalsize #1
    \clearpage
    \thispagestyle{empty}
    {\centering\red{\Large\bd{[ 교사용 페이지(양면) 2/2 ]}} \par}
    \vspace{1em}
    \normalsize #2
    \clearpage
    \addtocounter{page}{-2}
  \fi
}
