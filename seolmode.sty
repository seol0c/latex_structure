%% \seolfa{단어} 형태로 사용
%% 출력 모드는 \seolmode 값으로 제어
% 1=그대로 출력
% 2=( 글자 숨김 ), 학생용 빈칸
% 3=( 붉게 강조 ), 답안배포용
% 4=( 붉게 강조 ) 및 메모 노출, 교사용

% 텍스트/수식 모두 안전하게 한 덩어리로 묶는 박스 만들기
% mbox는 텍스트만 됨. 줄바꿈을 막기 위해 한 덩어리 취급하는 박스 제작
\newcommand{\nobreakbox}[1]{\ifmmode\mathchoice
      {\hbox{$\displaystyle #1$}}
      {\hbox{$\textstyle #1$}}
      {\hbox{$\scriptstyle #1$}}
      {\hbox{$\scriptscriptstyle #1$}}\else\mbox{#1}\fi}

\newcount\seolmode

\newcommand{\seolfa}[1]{% a는 괄호가 있음. 하나의 덩어리로 묶어서 줄바꿈 되지 않게 함.
  \ifnum\seolmode=1
    \nobreakbox{\hly{\bd{#1}}} % 노랑 형광펜과 bold 글씨
  \else\ifnum\seolmode=2
    \nobreakbox{(\quad \hlp{\phantom{\bd{#1}}} \quad)} % 투명 형광펜과 투명 bold 글씨 - 형광펜을 또 해줘야 위아래 폭 동일함
  \else\ifnum\seolmode=3
    \nobreakbox{\red{(\quad \hly{\bd{#1}} \quad)}} % 빨간 형광펜과 bold 글씨
  \else\ifnum\seolmode=4
    \nobreakbox{\red{(\quad \hly{\bd{#1}} \quad)}}\fi\fi\fi\fi}

\newcommand{\seolfb}[1]{% b는 괄호가 없음. 표 안의 내용 등에 활용. 줄바꿈 가능
  \ifnum\seolmode=1
    \hly{\bd{#1}} % 노랑 형광펜과 bold 글씨
  \else\ifnum\seolmode=2
    \hlp{\phantom{\bd{#1}}} % 투명 형광펜과 투명 bold 글씨
  \else\ifnum\seolmode=3
    \hly{\red{\bd{#1}}} % 빨간 형광펜과 bold 글씨
  \else\ifnum\seolmode=4
    \hly{\red{\bd{#1}}}\fi\fi\fi\fi}

%% 교사용 녹색 하이라이트 (seolmode가 4일 때는 \hll(라임형광펜), 나머지는 \hlp(투명) - 똑같이 여백 차지
\newcommand{\seoli}[1]{%
  \ifnum\seolmode=4 \hll{#1}%
  \else \hlp{#1}\fi}

%% memo 마커 (seolmode가 4일 때만 출력하고 1,2,3일때는 사라짐 - 처음부터 공간 차지 안함)
% 페이지가 밀리는 경우 메모 위치가 함께 밀릴 수 있으나 컴파일 두 번하면 제대로 배치됨.
% 박스가 밀려나지 않게 안쪽으로 shift 함
\newcounter{memomark}
\newcommand{\memo}[1]{
  \ifnum\seolmode=4 % 항상 zz로 한 줄 없애고 시작하기. 언제나 독립적으로 위아래가 비워진 상태로 memo 삽입해야 함
  \stepcounter{memomark} % memomark를 이용해서 현재 좌표 기억(0,0)하게 함.
  \tikz[remember picture,baseline]{\coordinate (memomark-\thememomark) at (0,0);}%
    \MeasureHalfFrom{ % 실제 박스와 똑같이 측정
      {\scriptsize\begingroup\setlength{\fboxsep}{0pt}%
       \colorbox{yellow!20}{\parbox{140pt}{#1}}%
       \endgroup}}
    \CoordsHere % 좌표 계산
    \ClampFromCoords % 보정량 산출(오프셋 반영)
  \zz[-\bs] \tikz[remember picture,overlay]{ % 현재 줄 기준 그림을 겹쳐서 출력 (본문 레이아웃에 영향 없음)
    \checkoddpage\ifoddpage % 홀수 페이지
    \node[yshift=0] at ($(current page.east |- memomark-\thememomark)+(-85pt,0)$)
      {\scriptsize\fboxsep=0pt\colorbox{yellow!20}{\parbox{140pt}{#1}}};
    \else % 짝수 페이지
    \node[yshift=0] at ($(current page.west |- memomark-\thememomark)+(85pt,0)$)
      {\scriptsize\fboxsep=0pt\colorbox{yellow!20}{\parbox{140pt}{#1}}};
      \fi}\fi\ignorespaces} % 좌표를 기억하고 빼면 본문이든 표 안이든 같은 (절대)좌표를 참조하게 됨

% 교사용 페이지 삽입 명령 - 3 이상일 때 노출됨
\newcommand{\insertTeacherPages}[2]{%
  \ifnum\seolmode>2
    \clearpage
    \thispagestyle{empty}
    {\centering\red{\Large\bd{[ 교사용 페이지(양면) 1/2 ]}} \par}
    \vspace{1em}
    \normalsize #1
    \clearpage
    \thispagestyle{empty}
    {\centering\red{\Large\bd{[ 교사용 페이지(양면) 2/2 ]}} \par}
    \vspace{1em}
    \normalsize #2
    \clearpage
    \addtocounter{page}{-2}\fi} % 페이지 카운트 2 다시 제거(원래대로 돌리기)
