%% 표 스타일 정의용 매크로

%% 자주 쓰는 열 정의
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}   % 가운데 정렬 고정폭 열
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}p{#1}} % 왼쪽 정렬 고정폭 열
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash}p{#1}}  % 오른쪽 정렬 고정폭 열

%% 기본 테이블 여백 조정
\setlength{\tabcolsep}{8pt}  % 셀 좌우 간격
\renewcommand{\arraystretch}{1.2}  % 행 간격

%% 강조 셀 스타일 - 기존에 정의한 색 재사용 (이미 \definecolor 되어 있어야 함)
\newcommand{\graycell}[1]{\cellcolor{mygray!20}#1}   % 회색 강조 셀
\newcommand{\redcell}[1]{\cellcolor{myred!20}#1}     % 빨간 강조 셀
\newcommand{\bluecell}[1]{\cellcolor{myblue!20}#1}   % 파란 강조 셀


%%%%% 표

%% 표 내에서 정렬이 편하도록 함수 명명
\newcommand{\leftcell}[1]{\raggedright #1\arraybackslash}
\newcommand{\centercell}[1]{\centering #1\arraybackslash}
\newcommand{\rightcell}[1]{\raggedleft #1\arraybackslash}

% \tab[h]{캡션}{라벨}{정렬}{내용} - 내용 빼고 모두 생략 가능
\newcommand{\tab}[5][H]{ % 기본 위치 here. 무조건 강하게 H
  \begin{table}[#1] % 표 float 환경 시작, 위에서 H로 지정함. 안써도 됨
    \vspace{-3pt} % 표 위로 살짝 올리기
    \centering % 표 가운데 정렬
    \ifthenelse{\isempty{#2}}{}{ % 캡션 내용 비어있으면 생략
      \caption{#2} % 캡션이 비어 있지 않으면 삽입. tabular 아래에 넣으면 캡션은 아래로 감
    }
    \ifthenelse{\isempty{#3}}{}{%
      \label{tab:#3} % 라벨이 비어 있지 않으면 tab: 접두사와 함께 삽입
    }
    {\fontsize{8}{10}\selectfont % 본문폰트 크기 10pt, 표 폰트 크기 8pt
    \begin{tabular}{#4} % 표 열 형식 지정
      \hline
      #5 \\ % 표 내용
      \hline
    \end{tabular}}
    \vspace{3pt}% 하단 살짝 여백 넣음
  \end{table}}

%% table 선언 쉽도록 함수 작성 - \DeclareTable{라벨}{명령이름}{캡션}{열형식}{내용} 순으로 입력하면 됨
\newcommand{\DeclareTable}[5]{
  \newcommand{#2}{
    \begin{table}[H]
      \vspace{-3pt}
      \centering
      \ifstrempty{#3}{}{%
        \caption{#3}
      }
      \ifstrempty{#1}{}{%
        \label{tab:#1}
      }
      {\fontsize{8}{10}\selectfont % 본문폰트 크기 10pt, 표 폰트 크기 8pt
      \begin{tabular}{#4}
        \hline
        #5 \\
        \hline
      \end{tabular}}
      \vspace{3pt}% 하단 살짝 여백 넣음
    \end{table}}}

%%%%% 그림
%% 본래 그림을 다음과 같이 선언해야 함
% \newcommand{\kelvintemperatures}{ - 명령 이름 작성
%     \begin{figure}[h] \centering \includegraphics[scale=0.6]
%     {../figures/kelvin_temperatures} - 파일 경로(파일명)
%     \caption{Some temperatures on the Kelvin scale} - 캡션(파일명과 동일)
%     \label{fig:kelvin_temperatures} \end{figure} } - 라벨

% 규칙
% 1. 그림을 최초 호출할 때는 100% 크기로 호출함.
% 2. 본문에서 최종 호출할 때 80% 기본 크기로 호출함. 본문 폰트는 10pt이고, 그림은 80%가 되도록 함.
% 즉, 기본 호출 배열(1단계)은 1배인데 수정 가능하다.
%     최종 호출 배열(2단계)은 안쓰면 0.8배(1단계에서 0.8배)인데 수정 가능하도록함
%     2단계에서 [1]을 넣으면 그림이 커진다. 1단계에서 정한 100% 크기가 되는 것이다.

% 그림 계열
% 1. 일러스트레이터로 그린 경우 10pt로 작성하므로, 최초 호출 1배율([] 필요 없음), 본문 호출 0.8배율([] 필요 없음)
% 2. python으로 그린 경우도 10pt로 작성하므로, 최초 호출 1배율([] 필요 없음), 본문 호출 0.8배율([] 필요 없음)
% 3. 일반물리학(12판, fundamental)의 경우 크롬 pdf에서 150%로 캡쳐하면,
%    최초 호출 0.8배율일 때 본문과 폰트 크기 같아짐. 이후 본문호출 0.8배율
%    즉, 1단계에서 [0.8]로 크기 조정하고, 본문에서는 ([] 필요 없음)

\renewcommand{\figurename}{Fig.} % 전역적으로 그림을 Figure가 아닌 Fig.로 표시

%% figure 선언 쉽도록 함수 작성
% \DeclareFigure[<1단계 기본배율(기본 1)>]{파일명(라벨)}{명령이름}{캡션} 순으로 입력하면 됨
% 그림 크기가 최초에 보정이 필요한 경우 \DeclareFigure[0.8]{}{\aaa}{}와 같이 시작함.
% 최초 배율(1단계)이 100%이 되도록 할 것
% 값을 쓰지 않는 경우 1배율([1])로 들어감.
% 이후 본문에서 \aaa[0.8] 으로 최종 배율(2단계) 호출
\NewDocumentCommand{\DeclareFigure}{O{1} m m m}{%
  \NewDocumentCommand{#3}{O{0.8}}{%
    \begin{figure}[H]\centering
      \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2}%
      \caption{#4}\label{fig:#2}%
    \end{figure}}}

%% figure - 번호, 라벨 없는 Notag 버전 - section 번호 누적되지 않도록 하기 위함
\NewDocumentCommand{\DeclareFigureNoTag}{O{1} m m m}{%
  \NewDocumentCommand{#3}{O{0.8}}{%
    \begin{figure}[H]\centering
      \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2}%
      \caption*{#4}% 번호 없음
    \end{figure}}}

%% 라벨 없이 간단하게 삽입하는 경우 - notag보다 유용
% \quickfig{파일명}으로 부를 수 있음.
% 기본 0.8배 크기로 삽입되지만 \quickfig[0.6]{파일명} 이런식으로 사이즈 변경 가능. [1]넣으면 크기 커짐(100%)
\NewDocumentCommand{\quickfig}{O{0.8} m}{%
  \begin{center}
    \includegraphics[scale=#1]{figures/#2}
  \end{center}}

% memo와 비슷하게 홀수짝수일 때 페이지 측면으로 붙는 그림 - 넘어가는 경우 shift되게 하여 항상 페이지 안쪽 유지
\newcounter{edgefiguremark}
\NewDocumentCommand{\DeclareEdgeFigure}{O{1} m m m}{%
  \NewDocumentCommand{#3}{O{0.8}}{%
    \stepcounter{edgefiguremark}%
    \tikz[remember picture,baseline]{\coordinate (edgefiguremark-\theedgefiguremark) at (0,0);}%
\MeasureHalfFrom{ % 실제 박스와 똑같이 측정
  \begin{minipage}{130pt}\centering
    \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2}\\[2pt]
    {\captionsetup{type=figure,width=\linewidth,hypcap=false}%
     \phantomsection\captionof*{figure}{#4}} % 번호 누적 없이 캡션 효과 고려
  \end{minipage}}%
    \CoordsHere % 좌표 계산
    \ClampFromCoords % 보정량 산출(오프셋 반영)
    \tikz[remember picture,overlay]{%
      \checkoddpage\ifoddpage % 홀수 페이지 → 오른쪽 엣지
        \node[yshift=\yshiftEdge] at ($(current page.east |- edgefiguremark-\theedgefiguremark)+(-82pt,0)$) { % 클램프 있는 경우 shift로 페이지 안쪽 이동
          \begin{minipage}{130pt}\centering
            \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2}\\[2pt]
            \phantomsection
            {\captionsetup{type=figure,width=\linewidth,hypcap=false}%
             \phantomsection\captionof{figure}{#4}\label{fig:#2}}%
          \end{minipage}};%
      \else % 짝수 페이지 → 왼쪽 엣지
        \node[yshift=\yshiftEdge] at ($(current page.west |- edgefiguremark-\theedgefiguremark)+(82pt,0)$) {%
          \begin{minipage}{130pt}\centering
            \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2}\\[2pt]
            \phantomsection
            {\captionsetup{type=figure,width=\linewidth,hypcap=false}%
             \phantomsection\captionof{figure}{#4}\label{fig:#2}}%
          \end{minipage}};%
          \fi}\ignorespaces}}


          
          
% 교사용 seolfig - 모드 3,4일때만 나오는 그림. 1,2에서는 자리만 차지
\NewDocumentCommand{\seolfig}{O{0.8} m}{%
  \begin{center}
    \ifnum\seolmode>2
      \includegraphics[scale=#1]{figures/#2}%
    \else
      \phantom{\includegraphics[scale=#1]{figures/#2}}%
    \fi \end{center}}

%% figure 2개짜리 함수 작성(파일명은 같고_a, _b만 달라야 함)
% \DeclareDoubleFigure[<1단계 기본배율(기본 1)>]{파일명(라벨)}{명령이름}{캡션} 순으로 입력하면 됨
\NewDocumentCommand{\DeclareDoubleFigure}{O{1} m m m}{%
  \NewDocumentCommand{#3}{O{0.8}}{%
    \begin{figure}[H] \centering
      \begin{subfigure}[b]{0.3\textwidth} % bottm으로 정렬(t,c 가능), 폭 지정 0.3
        \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2_a}%
        \caption{}\label{fig:#2:a} % a, b, c 순차적으로 캡션 붙음, 하나씩 라벨 호출할 수 있음
      \end{subfigure}
      \begin{subfigure}[b]{0.3\textwidth}
        \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2_b}%
        \caption{}\label{fig:#2:b}
      \end{subfigure}
      \caption{#4}
      \label{fig:#2}
    \end{figure}}}

%% figure 3개짜리 함수 작성(파일명은 같고_a, _b, _c만 달라야 함) - \DeclareTripleFigure{파일명(라벨)}{명령이름}{캡션} 순으로 입력하면 됨
\NewDocumentCommand{\DeclareTripleFigure}{O{1} m m m}{%
  \NewDocumentCommand{#3}{O{0.8}}{%
    \begin{figure}[H] \centering
      \begin{subfigure}[b]{0.3\textwidth} % bottm으로 정렬(t,c 가능), 폭 지정 0.3
        \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2_a}%
        \caption{}\label{fig:#2:a} % a, b, c 순차적으로 캡션 붙음, 하나씩 라벨 호출할 수 있음
      \end{subfigure}
      \begin{subfigure}[b]{0.3\textwidth}
        \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2_b}%
        \caption{}\label{fig:#2:b}
      \end{subfigure}
      \begin{subfigure}[b]{0.3\textwidth}
        \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2_c}%
        \caption{}\label{fig:#2:c}
      \end{subfigure}
      \caption{#4}
      \label{fig:#2}
    \end{figure}}}


%% figure 6개짜리 함수 작성 (파일명은 같고 _a ~ _f까지 순차적으로, 3개씩 2줄 배치)
%% 사용법: \DeclareQuadFigure{파일명(라벨)}{명령이름}{캡션}
\NewDocumentCommand{\DeclareQuadFigure}{O{1} m m m}{%
  \NewDocumentCommand{#3}{O{0.8}}{%
    \begin{figure}[H] \centering
      % 1행: a, b, c
      \begin{subfigure}[b]{0.3\textwidth}  % 첫 번째 줄: a, b, c
        \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2_a}%
        \caption{}\label{fig:#2:a}
      \end{subfigure}
      \begin{subfigure}[b]{0.3\textwidth}
        \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2_b}%
        \caption{}\label{fig:#2:b}
      \end{subfigure}
      \begin{subfigure}[b]{0.3\textwidth}
        \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2_c}%
        \caption{}\label{fig:#2:c}
      \end{subfigure}
      \par\medskip % 줄바꿈 + 여백
      \begin{subfigure}[b]{0.3\textwidth}  % 두 번째 줄: d, e, f
        \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2_d}%
        \caption{}\label{fig:#2:d}
      \end{subfigure}
      \begin{subfigure}[b]{0.3\textwidth}
        \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2_e}%
        \caption{}\label{fig:#2:e}
      \end{subfigure}
      \begin{subfigure}[b]{0.3\textwidth}
        \includegraphics[scale=\fpeval{#1*(##1)}]{figures/#2_f}%
        \caption{}\label{fig:#2:f}
      \end{subfigure}
      \caption{#4}
      \label{fig:#2}
    \end{figure}}}
